<!-- <!DOCTYPE html>
<html>

<head>
    <title>Live Feed</title>
</head>

<body>
    <h2>Live Feed of Posts</h2>
    <table border="1">
        <tr>
            <th>Date</th>
            <th>Original Text</th>
            <th>Translated Text</th>
            <th>Sentiment</th>
            <th>Score</th>
        </tr>
        {% for post in posts %}
        <tr>
            <td>{{ post.date }}</td>
            <td>{{ post.original_text }}</td>
            <td>{{ post.translated_text }}</td>
            <td>{{ post.predicted_label }}</td>
            <td>{{ post.predicted_score|floatformat:2 }}</td>
        </tr>
        {% endfor %}
    </table>
</body>

</html> -->

<!DOCTYPE html>
<html>

<head>
    <title>Live Feed</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
        table {
            border-collapse: collapse;
            width: 100%;
        }

        th,
        td {
            border: 1px solid #ccc;
            padding: 8px;
        }

        th {
            background: #eee;
        }

        .pagination {
            margin-top: 10px;
        }

        .pagination button {
            padding: 5px 10px;
            margin: 0 2px;
        }
    </style>
</head>

<body>
    <h2>Live Feed of Posts</h2>
    <table id="postsTable">
        <thead>
            <tr>
                <th>Date</th>
                <th>Original Text</th>
                <th>Translated Text</th>
                <th>Sentiment</th>
                <th>Score</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>

    <div class="pagination">
        <button id="prevBtn">⬅ Prev</button>
        <span id="pageInfo"></span>
        <button id="nextBtn">Next ➡</button>
    </div>

    <script>
        let currentPage = 1;
        let totalPages = 1;

        function fetchPosts(page = 1) {
            $.get("{% url 'live_feed_data' %}", { page: page }, function (data) {
                const tbody = $("#postsTable tbody");
                tbody.empty();
                data.posts.forEach(post => {
                    tbody.append(`
                <tr>
                    <td>${post.date}</td>
                    <td>${post.original_text}</td>
                    <td>${post.translated_text}</td>
                    <td>${post.predicted_label}</td>
                    <td>${post.predicted_score.toFixed(2)}</td>
                </tr>
            `);
                });
                currentPage = page;
                totalPages = data.total_pages;
                $("#pageInfo").text(`Page ${currentPage} / ${totalPages}`);
            });
        }

        // Pagination buttons
        $("#prevBtn").click(() => { if (currentPage > 1) fetchPosts(currentPage - 1); });
        $("#nextBtn").click(() => { if (currentPage < totalPages) fetchPosts(currentPage + 1); });

        // Initial fetch
        fetchPosts();

        // Auto-refresh every 5 seconds for page 1
        setInterval(() => { if (currentPage === 1) fetchPosts(1); }, 5000);
    </script>
</body>

</html>